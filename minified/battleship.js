!function(){"use strict";function f(a){this.player=a,this.enemyGrid=new Grid,this.potentialShots=new h}function g(a,b,c){this.x=a,this.y=b,this.ship=c}function h(){this.probability=[],this.ships={},this.ships.CARRIER={fleet:3,length:5,identifier:"C",fleetType:Fleet.CARRIER,shots:[],probability:[],weight:5},this.ships.BATTLESHIP={fleet:1,length:4,identifier:"B",fleetType:Fleet.BATTLESHIP,shots:[],probability:[],weight:4},this.ships.DESTROYER={fleet:2,length:3,identifier:"D",fleetType:Fleet.DESTROYER,shots:[],probability:[],weight:3},this.ships.SUBMARINE={fleet:3,length:3,identifier:"S",fleetType:Fleet.SUBMARINE,shots:[],probability:[],weight:3},this.ships.PATROLBOAT={fleet:4,length:2,identifier:"P",fleetType:Fleet.PATROLBOAT,shots:[],probability:[],weight:2}}function k(a,d){void 0==d&&(d="My");var e="";e+="    0  1  2  3  4  5  6  7  8  9\n";for(var f=0;f<b;f++){e+=f+"  ";for(var g=0;g<c;g++){var h=a.getShipByCoord(f,g),i=h?h.type:"";switch(i){case Fleet.BATTLESHIP:e+=" B ";break;case Fleet.CARRIER:e+=" C ";break;case Fleet.PATROLBOAT:e+=" P ";break;case Fleet.DESTROYER:e+=" D ";break;case Fleet.SUBMARINE:e+=" S ";break;default:e+=" - "}}e+="\n"}e+="\n",console.log(d+" location: "),console.log(e)}function l(a){var d="";d+="    0  1  2  3  4  5  6  7  8  9\n";for(var e=0;e<b;e++){d+=e+"  ";for(var f=0;f<c;f++){var g=a.cells[e][f],h="-";void 0!=g.state&&(h=g.state),d+=" "+h+" "}d+="\n"}d+="\n",console.log("Enemy Grid Table: "),console.log(d)}function m(a){var d,e,f,g;for(var h in a.ships)if(a.ships.hasOwnProperty(h)){var i=a.ships[h];for(d="",f=0;f<b;f++){for(e=0;e<c;e++)g=i.probability[f][e].p,d+=" "+g+" ";d+="\n"}console.log("Enemy Probability Table for ship: "+h),console.log(d),d+="\n"}for(d="",f=0;f<b;f++){for(e=0;e<c;e++)g=a.probability[f][e].p,d+=" "+g+" ";d+="\n"}console.log("Total Probability"),console.log(d)}function p(a,b,c,d){this.winner=null,o=b,n=a,this.AIOne=c,this.AITwo=d}function q(a){this.type=a,this.grid=new Grid,this.shotsTaken=0,this.hitsDealt=0,this.accuracy=function(){return this.hitsDealt/this.shotsTaken}}function r(a){this.playerOne=new q(q.PLAYERONE),this.playerTwo=new q(q.PLAYERTWO),this.AIOne=new CandidateAI(this.playerOne),this.AITwo=new f(this.playerTwo),this.game=new p(this.playerOne,this.playerTwo,this.AIOne,this.AITwo),this.numSimulations=a,this.playerOneHeatMap=new Grid,this.playerTwoHeatMap=new Grid,this.scorecard={Candidate_AI:0,NM_AI:0},this.accuracyByGame={Candidate_AI:[],NM_AI:[]},this.shotsByGame={Candidate_AI:[],NM_AI:[]},this.hitsByGame={Candidate_AI:[],NM_AI:[]},this.averageAccuracy=function(){for(var b=0,c=0,d=0;d<a;++d)b+=this.accuracyByGame.Candidate_AI[d],c+=this.accuracyByGame.NM_AI[d];return{Candidate_AI:b/a,NM_AI:c/a}}}function s(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b/a.length}var a="OFF",b=10,c=10,d="PLAY",e="Q";h.prototype.initialize=function(){this.clearTotalProbability();for(var a in this.ships)this.ships.hasOwnProperty(a)&&this.clearProbabilityForThisShip(a)},h.prototype.clearTotalProbability=function(){for(var a=0;a<b;a++){this.probability[a]=[];for(var d=0;d<c;d++)this.probability[a].push({p:0})}},h.prototype.clearProbabilityForThisShip=function(a){for(var d=this.ships[a],e=0;e<b;e++){d.probability[e]=[];for(var f=0;f<c;f++)d.probability[e].push({p:0})}},f.prototype.initializeSimulation=function(){},f.prototype.initializeGame=function(){var f=-1,h=0;this.enemyGrid.initialize(),this.potentialShots.initialize(),this.getNextCoord=function(){return++f>9&&(f=0,++h),this.enemyGrid.cells[f][h].state===Cell.TYPE_EMPTY?{x:f,y:h}:this.getNextCoord()},this.getRandomCoord=function(){var a=j(0,b),d=j(0,c);return this.enemyGrid.cells[a][d].state===Cell.TYPE_EMPTY?{x:a,y:d}:this.getRandomCoord()},this.getNextProbableCoord=function(a){if("number"==typeof a?a++:a=1,a>100)return this.getRandomCoord();for(var d=0,f=new g,h=0;h<b;h++)for(var i=0;i<c;i++){var j=this.potentialShots.probability[h][i].p;!isNaN(j)&&j>d&&(this.enemyGrid.cells[h][i].state===Cell.TYPE_EMPTY||this.enemyGrid.cells[h][i].state===e)&&(d=j,f=new g(h,i))}var k=f.x,l=f.y;try{return void 0!=this.enemyGrid.cells[k][l]&&void 0!=this.enemyGrid.cells[k][l].state&&this.enemyGrid.cells[k][l].state===Cell.TYPE_EMPTY?{x:k,y:l}:this.getNextProbableCoord(a)}catch(a){return this.getRandomCoord()}},this.addPotentialShotsForShip=function(b,c,d){var e=void 0,f=void 0;if(b.shots.length<1)this.pushShipShot(c+1,d,b),this.pushShipShot(c-1,d,b),this.pushShipShot(c,d+1,b),this.pushShipShot(c,d-1,b),e=i(b.fleetType,this.enemyGrid.fleet),this.enemyGrid.cells[c][d].state=b.identifier,f=new Cell,f.setShip(e),f.ship.location={x:c,y:d,direction:null},f.state=Cell.TYPE_SHIP,e.cells.push(f);else{var g=Ship.HORIZONTAL;this.previousShipShot(c+1,d,b.identifier)?(g=Ship.VERTICAL,this.pushShipShot(c+2,d,b),this.pushShipShot(c-1,d,b)):this.previousShipShot(c-1,d,b.identifier)?(this.pushShipShot(c+1,d,b),this.pushShipShot(c-2,d,b),g=Ship.VERTICAL):this.previousShipShot(c+2,d,b.identifier)||this.previousShipShot(c-2,d,b.identifier)?(g=Ship.VERTICAL,this.pushShipShot(c+1,d,b),this.pushShipShot(c-1,d,b)):this.previousShipShot(c,d+1,b.identifier)?(this.pushShipShot(c,d+2,b),this.pushShipShot(c,d-1,b),g=Ship.HORIZONTAL):this.previousShipShot(c,d-1,b.identifier)?(this.pushShipShot(c,d+1,b),this.pushShipShot(c,d-2,b),g=Ship.HORIZONTAL):this.previousShipShot(c,d+2,b.identifier)||this.previousShipShot(c,d-2,b.identifier)?(this.pushShipShot(c,d+1,b),this.pushShipShot(c,d-1,b),g=Ship.HORIZONTAL):("OFF"!=a&&console.log("THIS SHOULD NEVER HAPPEN"),g=null),e=i(b.fleetType,this.enemyGrid.fleet),this.enemyGrid.cells[c][d].state=b.identifier,f=new Cell,f.setShip(e),f.ship.location={direction:g},f.state=Cell.TYPE_SHIP,e.cells.push(f)}},this.addPotentialShots=function(a,b,c){switch(c){case Fleet.BATTLESHIP:this.addPotentialShotsForShip(this.potentialShots.ships.BATTLESHIP,a,b);break;case Fleet.CARRIER:this.addPotentialShotsForShip(this.potentialShots.ships.CARRIER,a,b);break;case Fleet.PATROLBOAT:this.addPotentialShotsForShip(this.potentialShots.ships.PATROLBOAT,a,b);break;case Fleet.DESTROYER:this.addPotentialShotsForShip(this.potentialShots.ships.DESTROYER,a,b);break;case Fleet.SUBMARINE:this.addPotentialShotsForShip(this.potentialShots.ships.SUBMARINE,a,b)}},this.previousShipShot=function(a,b,c){return!(a<0||a>9||b<0||b>9)&&this.enemyGrid.cells[a][b].state===c},this.pushShipShot=function(a,b,c){void 0!=this.enemyGrid.cells[a]&&void 0!=this.enemyGrid.cells[a][b]&&this.enemyGrid.cells[a][b].state===Cell.TYPE_EMPTY&&(c.shots.push(new g(a,b,c.fleet)),this.enemyGrid.cells[a][b].state=e)},this.getFleetFromShip=function(a){switch(a){case Fleet.CARRIER:return"CARRIER";case Fleet.BATTLESHIP:return"BATTLESHIP";case Fleet.DESTROYER:return"DESTROYER";case Fleet.SUBMARINE:return"SUBMARINE";case Fleet.PATROLBOAT:return"PATROLBOAT";default:return null}},this.updateSunkShip=function(a){var d=this.getFleetFromShip(a),f=this.enemyGrid.fleet.ships[d];f.isSunk=!0;for(var g=this.potentialShots.ships[d],h=g.shots.length;h--;){var i=g.shots.pop();this.enemyGrid.cells[i.x][i.y].state===e&&(this.enemyGrid.cells[i.x][i.y].state=Cell.TYPE_EMPTY)}for(var j=0;j<b;j++)for(var k=0;k<c;k++)this.enemyGrid.cells[j][k].state===g.identifier&&(this.enemyGrid.cells[j][k].state=Cell.TYPE_SUNK)},this.getNextShot=function(){this.calculateProbabilityOfFutureShots();var a={x:null,y:null};for(var b in this.potentialShots.ships)if(this.potentialShots.ships.hasOwnProperty(b)){var c=this.potentialShots.ships[b];if(c.shots.length>0){a=c.shots.pop();break}}return null!=a.x?{x:a.x,y:a.y}:"PLAY"===d?this.getNextProbableCoord():"RANDOM"===d?this.getRandomCoord():this.getNextCoord()},this.calculateProbabilityOfFutureShots=function(){this.potentialShots.clearTotalProbability();for(var d in this.potentialShots.ships)if(this.potentialShots.ships.hasOwnProperty(d)){var e=this.potentialShots.ships[d];this.potentialShots.clearProbabilityForThisShip(d);var f=this.enemyGrid.fleet.ships[d];if(!f.isSunk)for(var g=e.length,h=0;h<b;h++)for(var i=0;i<c;i++){for(var j=0,k=h-g;k<b;k++)if(!(k<0||k>h||k>b)){var l=k+g;if(!(l>=b))for(var n=k;n<l;n++){if(this.enemyGrid.cells[n][i].state!=Cell.TYPE_EMPTY){j=0;break}j++}}for(var o=i-g;o<c;o++)if(!(o<0||o>i||o>c)){var p=o+g;if(!(p>=c))for(var n=o;n<p;n++){if(this.enemyGrid.cells[h][n].state!=Cell.TYPE_EMPTY){j=0;break}j++}}e.probability[h][i].p=j,this.potentialShots.probability[h][i].p=this.potentialShots.probability[h][i].p+j}}"OFF"!=a&&m(this.potentialShots)}},f.prototype.startGame=function(){this.startGameHelper(Fleet.CARRIER),this.startGameHelper(Fleet.BATTLESHIP),this.startGameHelper(Fleet.DESTROYER),this.startGameHelper(Fleet.SUBMARINE),this.startGameHelper(Fleet.PATROLBOAT),"OFF"!=a&&(k(this.player.grid),l(this.enemyGrid),console.log("\n\n\n=> => THE HUNT IS ON <= <=\n\n\n"))},f.prototype.startGameHelper=function(a){for(;!this.player.grid.dockShip(j(0,b),j(0,c),j(0,2),a););},f.prototype.shoot=function(){var b=this.getNextShot(),c=b.x,d=b.y,e=this.player.shoot(c,d);switch(this.enemyGrid.cells[c][d].state=e.state,e.state){case Cell.TYPE_HIT:case Cell.TYPE_SHIP:this.enemyGrid.cells[c][d].state=e.state,this.addPotentialShots(c,d,e.ship);break;case Cell.TYPE_SUNK:this.enemyGrid.cells[c][d].state=e.state,this.updateSunkShip(e.ship)}"OFF"!=a&&(console.log("Taking a shot at: ["+c+","+d+"]"),l(this.enemyGrid))},f.prototype.endGame=function(){"OFF"!=a&&console.log("Taken: "+this.player.shotsTaken+" Dealt: "+this.player.hitsDealt)};var n,o,i=function(a,b){switch(a){case Fleet.CARRIER:return b.ships.CARRIER;case Fleet.BATTLESHIP:return b.ships.BATTLESHIP;case Fleet.DESTROYER:return b.ships.DESTROYER;case Fleet.SUBMARINE:return b.ships.SUBMARINE;case Fleet.PATROLBOAT:return b.ships.PATROLBOAT;default:return null}},j=function(a,b){return Math.floor(Math.random()*(b-a))+a};p.prototype.initialize=function(){this.winner=null,n.initialize(),o.initialize(),this.AIOne.initializeGame(),this.AITwo.initializeGame()},p.prototype.playGame=function(){this.AIOne.startGame(),this.AITwo.startGame(),this.playerOneState=n.grid.fleet.ships,this.playerTwoState=o.grid.fleet.ships;var a=this.getRandomPlayer(),c=(a.type===q.PLAYERONE?o:n,a.type===q.PLAYERONE?this.AIOne:this.AITwo),d=a.type===q.PLAYERONE?this.AITwo:this.AIOne;for(this.winner=this.isOver();this.winner===!1&&(c.shoot(),this.winner=this.isOver(),this.winner===!1);)d.shoot(),this.winner=this.isOver();this.AIOne.endGame(),this.AITwo.endGame()},p.shoot=function(a,b,c){if(b<0||b>9||c<0||c>9)return!1;var d=a.type===q.PLAYERONE?o:n,e=d.grid.getCell(b,c);return e.state===Cell.TYPE_MISS||e.state===Cell.TYPE_HIT||e.state===Cell.TYPE_SUNK?{state:null,ship:null}:(++a.shotsTaken,++e.temperature,e.state===Cell.TYPE_SHIP?(++a.hitsDealt,e.state=Cell.TYPE_HIT,e.ship.hit(),e.ship.isSunk&&e.ship.cells.filter(function(a){a.state=Cell.TYPE_SUNK})):e.state=Cell.TYPE_MISS,{state:e.state,ship:null===e.ship?null:e.ship.type})},p.prototype.isOver=function(){return n.grid.fleet.isSunk()?o:o.grid.fleet.isSunk()?n:!n.grid.fleet.isPlaced()&&o.grid.fleet.isPlaced()?o:n.grid.fleet.isPlaced()&&!o.grid.fleet.isPlaced()?n:n.grid.fleet.isPlaced()||o.grid.fleet.isPlaced()?n.grid.fleet.hasMoved(this.playerOneState)?o:!!o.grid.fleet.hasMoved(this.playerTwoState)&&n:this.getRandomPlayer()},p.prototype.getRandomPlayer=function(){return Math.floor(10*Math.random())%2===0?n:o},q.prototype.initialize=function(){this.grid.initialize(),this.shotsTaken=0,this.hitsDealt=0},q.prototype.shoot=function(a,b){return p.shoot(this,a,b)},q.PLAYERONE=1,q.PLAYERTWO=2,r.prototype.startSimulation=function(){this.AIOne.initializeSimulation(),this.AITwo.initializeSimulation();for(var a=0;a<this.numSimulations;++a){this.game.initialize(),this.game.playGame(),this.game.winner.type===q.PLAYERONE?++this.scorecard.Candidate_AI:++this.scorecard.NM_AI,this.accuracyByGame.Candidate_AI.push(this.playerOne.accuracy()),this.accuracyByGame.NM_AI.push(this.playerTwo.accuracy()),this.shotsByGame.Candidate_AI.push(this.playerOne.shotsTaken),this.shotsByGame.NM_AI.push(this.playerTwo.shotsTaken),this.hitsByGame.Candidate_AI.push(this.playerOne.hitsDealt),this.hitsByGame.NM_AI.push(this.playerTwo.hitsDealt);for(var b=0;b<10;++b)for(var c=0;c<10;++c)this.playerOneHeatMap.cells[b][c].temperature+=this.playerOne.grid.cells[b][c].temperature,this.playerTwoHeatMap.cells[b][c].temperature+=this.playerTwo.grid.cells[b][c].temperature;this.AIOne.endGame(),this.AITwo.endGame()}this.initializeSimulation=this.AIOne.initializeSimulation.toString().match(/function[^{]+\{([\s\S]*)\}$/)[1],this.initializeGame=this.AIOne.initializeGame.toString().match(/function[^{]+\{([\s\S]*)\}$/)[1],this.startGame=this.AIOne.startGame.toString().match(/function[^{]+\{([\s\S]*)\}$/)[1],this.shoot=this.AIOne.shoot.toString().match(/function[^{]+\{([\s\S]*)\}$/)[1],this.endGame=this.AIOne.endGame.toString().match(/function[^{]+\{([\s\S]*)\}$/)[1]};var t=new r(999);t.startSimulation(),document.getElementById("nm-ai-score").innerHTML=t.scorecard.NM_AI,document.getElementById("nm-ai-accuracy").innerHTML=(100*s(t.accuracyByGame.NM_AI)).toFixed(2)+"%",document.getElementById("nm-ai-shots-taken").innerHTML=s(t.shotsByGame.NM_AI),document.getElementById("nm-ai-hits").innerHTML=s(t.hitsByGame.NM_AI),document.getElementById("candidate-ai-score").innerHTML=t.scorecard.Candidate_AI,document.getElementById("candidate-ai-accuracy").innerHTML=(100*s(t.accuracyByGame.Candidate_AI)).toFixed(2)+"%",document.getElementById("candidate-ai-shots-taken").innerHTML=s(t.shotsByGame.Candidate_AI),document.getElementById("candidate-ai-hits").innerHTML=s(t.hitsByGame.Candidate_AI),window.$vars={candidate_initializeSimulation:t.initializeSimulation,candidate_initializeGame:t.initializeGame,candidate_startGame:t.startGame,candidate_shoot:t.shoot,candidate_endGame:t.endGame},t.scorecard.NM_AI>t.scorecard.Candidate_AI?(document.getElementById("candidate-ai-score").classList.add("loss"),document.getElementById("nm-ai-score").classList.add("win")):t.scorecard.NM_AI<t.scorecard.Candidate_AI?(document.getElementById("candidate-ai-score").classList.add("win"),document.getElementById("nm-ai-score").classList.add("loss")):(document.getElementById("candidate-ai-score").classList.add("tie"),document.getElementById("nm-ai-score").classList.add("tie"))}();